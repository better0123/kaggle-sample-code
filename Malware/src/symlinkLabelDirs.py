import glob
import shutil
import os.path
from TrainLabels import TrainLabels

DOWNLOAD    = "/home/chefele/kaggle/Malware/download/"
DATA_DIR    = "/home/chefele/kaggle/Malware/data/train/"

def clean_dir(adir):
    if os.path.exists(adir):
        shutil.rmtree(adir)
    os.makedirs(adir)

def make_label_dirs():
    for label in range(1, 9+1):
        adir = DATA_DIR + str(label)
        clean_dir(adir)

def link_files(fname_match):
    labels = TrainLabels()
    for path in glob.glob(DOWNLOAD + fname_match):
        basename = os.path.basename(path)
        prefix = basename.split('.')[0]
        label = labels.id_to_label(prefix)
        symlink = DATA_DIR + str(label) + '/' + basename
        os.symlink(path, symlink)
        print "symlink:", symlink, "-->", path

def main():
    make_label_dirs()
    link_files('train/*.bytes')
    link_files('train/*.asm')

if __name__ == '__main__':
    main()
