import glob
import os.path
import pandas

DOWNLOAD_DIR = "../download/"
LABELS_FILE  = "../download/trainLabels.csv"

def train_labels():
    df = pandas.read_csv(LABELS_FILE)
    d = {}
    for fileId, label in zip(df.Id, df.Class):
        d[fileId] = label
    return d

def parse_file(path):
    for fname in glob.glob(DOWNLOAD_DIR + path):
        _, basename = os.path.dirname(fname), os.path.basename(fname)
        ncalls = 0 
        calls = set()
        for line in open(fname, 'r'):
            line   = line.strip()
            tokens = line.split()
            if len(tokens) >=2 and tokens[1] in ("E8", "FF", "9A") and "call " in line and " sub_" not in line:
                ncalls += 1
                calls.add(' '.join(tokens[1:]))
        print
        print fname, "ncalls:", ncalls 
        print "unique calls:"
        for c in calls:
            print "\t", c

#parse_file('train/*.bytes')
#parse_file('train/*.bytes')
#parse_file('test/*.asm')

parse_file('train/*.asm')

